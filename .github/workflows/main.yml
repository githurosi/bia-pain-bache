name: Sync OpenCorePkg

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

permissions:
  contents: write
  id-token: write
  pull-requests: write  # æ–°å¢PRæƒé™

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      # ...ï¼ˆå‰é¢æ­¥éª¤ä¿æŒä¸å˜ï¼‰...

      - name: ğŸ” è®¾ç½®Gitæƒé™
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

      - name: ğŸš€ æäº¤åˆ°æ‚¨çš„ä»“åº“ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ”„ åŒæ­¥ OpenCorePkg æœ€æ–°å†…å®¹"
          branch: main
          file_pattern: "dist/**"
          commit_options: '--allow-empty'
          push_options: '--force-with-lease'
        continue-on-error: true

      - name: ğŸ”„ åˆ›å»ºPRï¼ˆå½“ç›´æ¥æ¨é€å¤±è´¥æ—¶ï¼‰
        if: ${{ failure() }}
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "ğŸ”„ åŒæ­¥ OpenCorePkg æœ€æ–°å†…å®¹"
          title: "è‡ªåŠ¨åŒæ­¥ OpenCorePkg æ›´æ–°"
          body: "åŒ…å«æœ€æ–°Binaryå’ŒDocsæ–‡ä»¶"
          branch: sync-bot/update
          base: main
