name: Sync OpenCorePkg

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

permissions:
  contents: write
  id-token: write
  pull-requests: write  # 新增PR权限

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      # ...（前面步骤保持不变）...

      - name: 🔐 设置Git权限
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

      - name: 🚀 提交到您的仓库（带错误处理）
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "🔄 同步 OpenCorePkg 最新内容"
          branch: main
          file_pattern: "dist/**"
          commit_options: '--allow-empty'
          push_options: '--force-with-lease'
        continue-on-error: true

      - name: 🔄 创建PR（当直接推送失败时）
        if: ${{ failure() }}
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "🔄 同步 OpenCorePkg 最新内容"
          title: "自动同步 OpenCorePkg 更新"
          body: "包含最新Binary和Docs文件"
          branch: sync-bot/update
          base: main
